#!/usr/bin/env bash

# https://testanything.org/tap-specification.html

testbin='./sshd_fixture.sh'

# Load list of SSHD tests from Makefile.am
d="$(dirname "$0")"
algos=''
load=0
while read -r l; do
  if [[ "${l}" = 'SSHD_TESTS ='* ]]; then
    load=1
  elif [ "${load}" = '1' ]; then
    algos="${algos} ${l/\\}"
    [[ ! "${l}" = *"\\" ]] && break
  fi
done < "${d}/Makefile.am"

count=1
total="$(echo "${algos}" | wc -w | tr -d ' ')"

echo "${count}..${total}"

for test in ${algos}; do
  if "${testbin}" "./${test}${EXEEXT}"; then
    res='ok'
  else
    res='not ok'
  fi
  echo "${res} ${count} - sshd-${test}"
  ((count++))
done
